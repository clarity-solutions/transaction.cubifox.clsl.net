{"version":3,"sources":["utils/ipfsURIToGatewayURI.ts","hooks/useQuery.ts","hooks/useMetadata.ts","constants.ts","hooks/useWeb3Provider.ts","hooks/useContract.ts","hooks/useWalletConnectPageState.ts","hooks/useItemOwnerAddress.ts","components/ItemInfoTable.tsx","components/buyerview/BuyerActionArea.tsx","components/buyerview/BuyerView.tsx","components/sellerview/ApproveButton.tsx","components/sellerview/PriceSelect.tsx","utils/weiPrice.ts","components/sellerview/SellButton.tsx","components/sellerview/SellerActionArea.tsx","components/sellerview/SellerView.tsx","WalletConnectPage.tsx","App.tsx","reportWebVitals.ts","index.tsx","logo.svg"],"names":["ipfsURIToGatewayURI","_ref","ipfsURI","startsWith","NFT_STORAGE_IPFS_GATEWAY_URI","replace","useQuery","search","useLocation","query","useMemo","URLSearchParams","tradeID","parseInt","get","poster","itemID","price","MetadataContainer","createContainer","_useState","useState","_useState2","Object","slicedToArray","status","setStatus","_useState3","_useState4","error","setError","_useState5","_useState6","metadata","setMetadata","fetchMetadata","useCallback","asyncToGenerator","regenerator_default","a","mark","_callee","tokenContract","tokenURI","response","wrap","_context","prev","next","sent","fetch","ok","t0","json","t1","t2","text","t3","t4","console","log","message","finish","stop","_x","apply","this","arguments","CUBIFOX_MARKET_CONTRACT_ADDRESS","CUBIFOX_MARKET_CONTRACT_ABI","CUBIFOX_TOKEN_CONTRACT_ABI","Web3ProviderContainer","currentUserAddress","setCurrentUserAddress","wcProvider","setWCProvider","setupWCProvider","provider","WalletConnectProvider","rpc","80001","enable","abrupt","checkNetworkIsCorrect","_ref2","_callee2","currentNetwork","_context2","getNetwork","chainId","getCurrentUser","_ref3","_callee3","accounts","_context3","request","method","_x2","ContractContainer","marketContract","setMarketContract","setTokenContract","linkMarketContract","signer","getSigner","contract","ethers","Contract","connect","err","linkTokenContract","contractWithSigner","WalletConnectPageStateContainer","preparingState","setPreparingState","userType","setUserType","sellingState","setSellingState","_useState7","_useState8","buyingState","setBuyingState","ItemOwnerAddressContainer","_useQuery","_WalletConnectPageSta","useContainer","itemOwnerAddress","setItemOwnerAddress","resolveCurrentOwner","address","ownerOf","toUpperCase","undefined","concat","ItemInfoTable","itemBelongsCurrentUser","_ItemOwnerAddressCont","useEffect","react_default","createElement","name","description","style","maxWidth","src","image","Fragment","BuyerActionArea","onBuy","wei","tx","result","utils","parseUnits","toString","executeTrade","value","wait","className","onClick","objectSpread","BuyerView","setItemBelongsCurrentUser","ItemInfoTable_ItemInfoTable","BuyerActionArea_BuyerActionArea","ApproveButton","approve","PriceSelect","unit","setPrice","setUnit","type","min","onChange","e","target","weiPrice","BigInt","Math","pow","SellButton","onSell","openTrade","disabled","SellerActionArea","ApproveButton_ApproveButton","PriceSelect_PriceSelect","SellButton_SellButton","SellerView","timer","setInterval","getApproved","clearInterval","includes","SellerActionArea_SellerActionArea","WalletConnectPage","_Web3ProviderContaine","_ContractContainer$us","_MetadataContainer$us","providers","Web3Provider","then","onDisconnect","disconnect","window","localStorage","removeItem","BuyerView_BuyerView","SellerView_SellerView","App","react_router_dom","Provider","logo","alt","react_router","path","element","WalletConnectPage_WalletConnectPage","reportWebVitals","onPerfEntry","Function","__webpack_require__","bind","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","document","getElementById","render","StrictMode","src_App","module","exports","p"],"mappings":"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","file":"static/js/main.869f960b.chunk.js","sourcesContent":["const NFT_STORAGE_IPFS_GATEWAY_URI = \"https://nftstorage.link\";\n\nexport const ipfsURIToGatewayURI = ({ ipfsURI }: { ipfsURI: string }) => {\n  if (ipfsURI.startsWith(\"https\")) {\n    return ipfsURI;\n  }\n  const uri =\n    NFT_STORAGE_IPFS_GATEWAY_URI + \"/ipfs/\" + ipfsURI.replace(\"ipfs://\", \"\");\n  return uri;\n};\n","import { useMemo } from \"react\";\nimport { useLocation } from \"react-router-dom\";\n\n// [期待するqueryStringのパラメーター]\n// * Userが Seller の時\n//   - itemID\n// * Userが Buyer の時\n//   - tradeID\n//   - poster\n//   - itemID\n//   - price\nexport const useQuery = () => {\n  const { search } = useLocation();\n  const query = useMemo(() => new URLSearchParams(search), [search]);\n\n  return {\n    tradeID: parseInt(query.get(\"tradeID\")!),\n    poster: query.get(\"poster\")!,\n    itemID: parseInt(query.get(\"itemID\")!),\n    price: parseInt(query.get(\"price\")!),\n  };\n};\n","import { useState, useCallback } from \"react\";\nimport { Metadata } from \"../types/Metadata\";\nimport { ipfsURIToGatewayURI } from \"../utils/ipfsURIToGatewayURI\";\nimport { useQuery } from \"./useQuery\";\nimport { ethers } from \"ethers\";\nimport { createContainer } from \"unstated-next\";\n\ntype Status = \"init\" | \"requesting\" | \"done\";\n\nconst useMetadata = () => {\n  const { itemID } = useQuery();\n  const [status, setStatus] = useState<Status>(\"init\");\n  const [error, setError] = useState<string | null>(null);\n  const [metadata, setMetadata] = useState<Metadata>();\n\n  const fetchMetadata = useCallback(\n    async (tokenContract: ethers.Contract) => {\n      setError(null);\n      setStatus(\"requesting\");\n      try {\n        const tokenURI = await tokenContract.tokenURI(itemID);\n        const response = await fetch(\n          ipfsURIToGatewayURI({ ipfsURI: tokenURI })\n        );\n        if (response.ok) {\n          setMetadata(await response.json());\n        } else {\n          setError(await response.text());\n        }\n      } catch (err) {\n        console.log(\"err\", err);\n        setError((err as Error).message);\n      } finally {\n        setStatus(\"done\");\n      }\n    },\n    [itemID]\n  );\n  return { metadata, fetchMetadata, status, error };\n};\n\nexport const MetadataContainer = createContainer(useMetadata);\n","export const CUBIFOX_MARKET_CONTRACT_ADDRESS =\n  \"0xa55E0A9F4DB29c03EfAb9D063B03309b73Cf32AA\";\n\nexport const CUBIFOX_MARKET_CONTRACT_ABI = [\n  \"function tradeIdCounter() view returns (uint256)\",\n  \"function openTrade(uint256 _itemId, uint256 _price)\",\n  \"function executeTrade(uint256 _tradeId) payable\",\n];\n\nexport const CUBIFOX_TOKEN_CONTRACT_ADDRESS =\n  \"0x9967a309fce3De66A70704431338a3d086509732\";\n\nexport const CUBIFOX_TOKEN_CONTRACT_ABI = [\n  \"function approve(address to, uint256 tokenId)\",\n  \"function getApproved(uint256 tokenId) view returns (address operator)\",\n  \"function tokenURI(uint256 tokenId) public view returns (string memory)\",\n  \"function ownerOf(uint256 tokenId) public view returns (address)\",\n];\n\nexport const WEB3_RPC_URL =\n  \"https://polygon-mumbai.infura.io/v3/1622077723654f928aaae17148265be5\";\n","import WalletConnectProvider from \"@walletconnect/ethereum-provider\";\nimport { ethers, providers } from \"ethers\";\nimport { useState, useCallback } from \"react\";\nimport { createContainer } from \"unstated-next\";\nimport { WEB3_RPC_URL } from \"../constants\";\n\nconst useProvider = () => {\n  const [currentUserAddress, setCurrentUserAddress] = useState<String>();\n  const [wcProvider, setWCProvider] = useState<WalletConnectProvider>();\n\n  const setupWCProvider = useCallback(async () => {\n    const provider = new WalletConnectProvider({\n      rpc: {\n        80001: WEB3_RPC_URL,\n      },\n      // qrcodeModalOptions: {\n      //   mobileLinks: [\n      //     \"rainbow\",\n      //     \"metamask\",\n      //     \"argent\",\n      //     \"trust\",\n      //     \"imtoken\",\n      //     \"pillar\",\n      //   ],\n      // },\n    });\n    //  Enable session (triggers QR Code modal)\n    await provider.enable();\n    setWCProvider(provider);\n    return wcProvider;\n  }, []);\n\n  const checkNetworkIsCorrect = useCallback(\n    async (provider: providers.Web3Provider) => {\n      const currentNetwork = await provider.getNetwork();\n      return currentNetwork.chainId == 80001;\n    },\n    []\n  );\n\n  const getCurrentUser = useCallback(\n    async (provider: WalletConnectProvider) => {\n      const accounts: [string] = await provider.request({\n        method: \"eth_requestAccounts\",\n      });\n      setCurrentUserAddress(accounts[0]);\n    },\n    [setCurrentUserAddress]\n  );\n\n  return {\n    currentUserAddress,\n    wcProvider,\n    setWCProvider,\n    setupWCProvider,\n    checkNetworkIsCorrect,\n    getCurrentUser,\n  };\n};\n\nexport const Web3ProviderContainer = createContainer(useProvider);\n","import { useState, useCallback } from \"react\";\nimport { ethers } from \"ethers\";\nimport { createContainer } from \"unstated-next\";\nimport {\n  CUBIFOX_MARKET_CONTRACT_ADDRESS,\n  CUBIFOX_MARKET_CONTRACT_ABI,\n  CUBIFOX_TOKEN_CONTRACT_ADDRESS,\n  CUBIFOX_TOKEN_CONTRACT_ABI,\n} from \"../constants\";\n\nconst useContract = () => {\n  const [marketContract, setMarketContract] = useState<ethers.Contract>();\n  const [tokenContract, setTokenContract] = useState<ethers.Contract>();\n\n  const linkMarketContract = useCallback(\n    (provider: ethers.providers.Web3Provider) => {\n      try {\n        const signer = provider.getSigner();\n        const contract = new ethers.Contract(\n          CUBIFOX_MARKET_CONTRACT_ADDRESS,\n          CUBIFOX_MARKET_CONTRACT_ABI,\n          provider\n        );\n        setMarketContract(contract.connect(signer));\n      } catch (err) {\n        throw err;\n      }\n    },\n    [setMarketContract]\n  );\n\n  const linkTokenContract = useCallback(\n    (provider: ethers.providers.Web3Provider) => {\n      try {\n        const signer = provider.getSigner();\n        const contract = new ethers.Contract(\n          CUBIFOX_TOKEN_CONTRACT_ADDRESS,\n          CUBIFOX_TOKEN_CONTRACT_ABI,\n          provider\n        );\n        const contractWithSigner = contract.connect(signer);\n        setTokenContract(contractWithSigner);\n        return contractWithSigner;\n      } catch (err) {\n        throw err;\n      }\n    },\n    [setTokenContract]\n  );\n\n  return {\n    marketContract,\n    tokenContract,\n    linkMarketContract,\n    linkTokenContract,\n  };\n};\n\nexport const ContractContainer = createContainer(useContract);\n","import { useState } from \"react\";\nimport { BuyingState } from \"../types/BuyingState\";\nimport { PreparingState } from \"../types/PreparingState\";\nimport { SellingState } from \"../types/SellingState\";\nimport { UserType } from \"../types/UserType\";\nimport { createContainer } from \"unstated-next\";\n\nconst useWalletConnectPageState = () => {\n  const [preparingState, setPreparingState] = useState<PreparingState>(\n    \"setupProvider\"\n  );\n  const [userType, setUserType] = useState<UserType>();\n  const [sellingState, setSellingState] = useState<SellingState>();\n  const [buyingState, setBuyingState] = useState<BuyingState>();\n\n  return {\n    preparingState,\n    setPreparingState,\n    userType,\n    setUserType,\n    sellingState,\n    setSellingState,\n    buyingState,\n    setBuyingState,\n  };\n};\n\nexport const WalletConnectPageStateContainer = createContainer(\n  useWalletConnectPageState\n);\n","import { useState, useEffect, useCallback } from \"react\";\nimport { BuyingState } from \"../types/BuyingState\";\nimport { SellingState } from \"../types/SellingState\";\nimport { useQuery } from \"./useQuery\";\nimport { ContractContainer } from \"./useContract\";\nimport { CUBIFOX_MARKET_CONTRACT_ADDRESS } from \"../constants\";\nimport { createContainer } from \"unstated-next\";\nimport { WalletConnectPageStateContainer } from \"./useWalletConnectPageState\";\n\n// useItemOwnerAddress() は状況に応じた itemOwnerAddress を返す\n//\n// [BuyerViewの場合]\n// 1. 基本は tokenContract.ownerOf で取得した値\n// 2. 1で取得した値がMarketContractだった場合はposter\n//\n// [SellerViewの場合]\n// 1. 基本は tokenContract.ownerOf で取得した値\n// 2. 1で取得した値がMarketContractだった場合は \"Cubifox Market\"\nconst useItemOwnerAddress = () => {\n  const { poster, itemID } = useQuery();\n  const {\n    buyingState,\n    sellingState,\n  } = WalletConnectPageStateContainer.useContainer();\n  const { tokenContract } = ContractContainer.useContainer();\n  const [itemOwnerAddress, setItemOwnerAddress] = useState<String>();\n\n  const resolveCurrentOwner = useCallback(async () => {\n    if (!tokenContract) return;\n    let address: string = \"\";\n\n    // BuyerViewの場合の1\n    // SellerViewの場合の1\n    try {\n      address = await tokenContract.ownerOf(itemID);\n      setItemOwnerAddress(address);\n    } catch (err) {\n      console.log(\"err\", err);\n    }\n\n    // BuyerViewの場合の2\n    if (\n      address.toUpperCase() == CUBIFOX_MARKET_CONTRACT_ADDRESS.toUpperCase() &&\n      buyingState != undefined\n    ) {\n      setItemOwnerAddress(poster);\n    }\n\n    // SellerViewの場合の2\n    if (\n      address.toUpperCase() == CUBIFOX_MARKET_CONTRACT_ADDRESS.toUpperCase() &&\n      sellingState != undefined\n    ) {\n      setItemOwnerAddress(\n        `Cubifox Market (${CUBIFOX_MARKET_CONTRACT_ADDRESS})`\n      );\n    }\n  }, [itemID, tokenContract, sellingState, buyingState]);\n\n  return { itemOwnerAddress, resolveCurrentOwner };\n};\n\nexport const ItemOwnerAddressContainer = createContainer(useItemOwnerAddress);\n","import React, { useEffect } from \"react\";\nimport { ItemOwnerAddressContainer } from \"../hooks/useItemOwnerAddress\";\nimport { MetadataContainer } from \"../hooks/useMetadata\";\nimport { useQuery } from \"../hooks/useQuery\";\nimport { BuyingState } from \"../types/BuyingState\";\nimport { SellingState } from \"../types/SellingState\";\nimport { ipfsURIToGatewayURI } from \"../utils/ipfsURIToGatewayURI\";\nimport { Web3ProviderContainer } from \"../hooks/useWeb3Provider\";\n\nexport const ItemInfoTable = ({\n  buyingState,\n  sellingState,\n  itemBelongsCurrentUser,\n}: {\n  buyingState?: BuyingState;\n  sellingState?: SellingState;\n  itemBelongsCurrentUser?: boolean;\n}) => {\n  const { price } = useQuery();\n  const { currentUserAddress } = Web3ProviderContainer.useContainer();\n  const { metadata } = MetadataContainer.useContainer();\n  const {\n    itemOwnerAddress,\n    resolveCurrentOwner,\n  } = ItemOwnerAddressContainer.useContainer();\n\n  useEffect(() => {\n    (async () => {\n      await resolveCurrentOwner();\n    })();\n  }, [buyingState, sellingState, itemOwnerAddress]);\n\n  if (!metadata) return null;\n  return (\n    <table>\n      <tbody>\n        <tr>\n          <th>Your Address</th>\n          <td>{currentUserAddress}</td>\n        </tr>\n        <tr>\n          <th>Item Name</th>\n          <td>{metadata.name}</td>\n        </tr>\n        <tr>\n          <th>Item Description</th>\n          <td>{metadata.description}</td>\n        </tr>\n        <tr>\n          <th>Item Image</th>\n          <td>\n            <img\n              style={{ maxWidth: \"50vw\" }}\n              src={ipfsURIToGatewayURI({ ipfsURI: metadata.image })}\n            />\n          </td>\n        </tr>\n        <tr>\n          <th>Current Owner</th>\n          <td>{itemOwnerAddress}</td>\n        </tr>\n        {price && !itemBelongsCurrentUser ? (\n          <tr>\n            <th>Price</th>\n            <td>{price} Wei MATIC</td>\n          </tr>\n        ) : (\n          <></>\n        )}\n      </tbody>\n    </table>\n  );\n};\n","import React, { useCallback } from \"react\";\nimport { ethers } from \"ethers\";\nimport { useQuery } from \"../../hooks/useQuery\";\nimport { ContractContainer } from \"../../hooks/useContract\";\nimport { WalletConnectPageStateContainer } from \"../../hooks/useWalletConnectPageState\";\n\nexport const BuyerActionArea = ({\n  itemBelongsCurrentUser,\n}: {\n  itemBelongsCurrentUser: boolean;\n}) => {\n  const { tradeID, price } = useQuery();\n  const {\n    setBuyingState,\n    buyingState,\n  } = WalletConnectPageStateContainer.useContainer();\n  const { marketContract } = ContractContainer.useContainer();\n\n  const onBuy = useCallback(\n    async ({ tradeID, price }: { tradeID: number; price: number }) => {\n      setBuyingState(\"executing\");\n      try {\n        const wei = ethers.utils.parseUnits(price.toString(), \"wei\");\n        console.log(\"price: \", wei);\n        const tx: ethers.providers.TransactionResponse = await marketContract!.executeTrade(\n          tradeID,\n          { value: wei }\n        );\n        const result = await tx.wait();\n\n        if (result.status == 1) {\n          setBuyingState(\"success\");\n        } else {\n          // 失敗するトランザクションは metamask 実行前にはじかれるはずなのでここは通らないかもしれない\n          console.log(\"failure [result]:\", result);\n          setBuyingState(\"failure\");\n        }\n      } catch (err) {\n        console.log(err);\n        setBuyingState(\"failure\");\n      }\n    },\n    []\n  );\n\n  if (itemBelongsCurrentUser || buyingState == \"success\") return null;\n\n  if (buyingState == \"executing\")\n    return (\n      <p className=\"message\">\n        Buy item request was sended. Please open your wallet app and approve the\n        transaction. It'll take few hours to finish transact.\n      </p>\n    );\n\n  if (buyingState == \"failure\")\n    return <p className=\"message\">Error is occurred.</p>;\n\n  return (\n    <button onClick={() => onBuy({ ...{ tradeID, price } })}>Buy Item</button>\n  );\n};\n","import React, { useEffect, useState } from \"react\";\nimport { ItemInfoTable } from \"../ItemInfoTable\";\nimport { WalletConnectPageStateContainer } from \"../../hooks/useWalletConnectPageState\";\nimport { ItemOwnerAddressContainer } from \"../../hooks/useItemOwnerAddress\";\nimport { Web3ProviderContainer } from \"../../hooks/useWeb3Provider\";\nimport { BuyerActionArea } from \"./BuyerActionArea\";\n\nexport const BuyerView = () => {\n  const {\n    buyingState,\n    setBuyingState,\n  } = WalletConnectPageStateContainer.useContainer();\n  const { itemOwnerAddress } = ItemOwnerAddressContainer.useContainer();\n  const { currentUserAddress } = Web3ProviderContainer.useContainer();\n  const [itemBelongsCurrentUser, setItemBelongsCurrentUser] = useState(false);\n\n  useEffect(() => {\n    setBuyingState(\"init\");\n  }, []);\n\n  // itemOwner が currentUser かチェックする\n  useEffect(() => {\n    if (!currentUserAddress || !itemOwnerAddress) return;\n\n    if (currentUserAddress.toUpperCase() == itemOwnerAddress.toUpperCase()) {\n      setItemBelongsCurrentUser(true);\n    }\n  }, [itemOwnerAddress, currentUserAddress]);\n\n  return (\n    <>\n      {itemBelongsCurrentUser ? (\n        <p>This item is already in your collection.</p>\n      ) : (\n        <p>Buy a collectible</p>\n      )}\n\n      <ItemInfoTable\n        buyingState={buyingState}\n        itemBelongsCurrentUser={itemBelongsCurrentUser}\n      />\n      <BuyerActionArea {...{ itemBelongsCurrentUser }} />\n    </>\n  );\n};\n","import React, { useCallback } from \"react\";\nimport { useQuery } from \"../../hooks/useQuery\";\nimport { ContractContainer } from \"../../hooks/useContract\";\nimport { ethers } from \"ethers\";\nimport { WalletConnectPageStateContainer } from \"../../hooks/useWalletConnectPageState\";\nimport { CUBIFOX_MARKET_CONTRACT_ADDRESS } from \"../../constants\";\n\n// Contract に ERC721トークン を transfer するために approve してもらう必要がある\n// https://github.com/OpenZeppelin/openzeppelin-contracts/blob/cb3f2ab900e39c5ab6e0de6663edf06f573b834f/contracts/token/ERC721/IERC721.sol#L61-L79\nexport const ApproveButton = () => {\n  const { itemID } = useQuery();\n  const { tokenContract } = ContractContainer.useContainer();\n  const { setSellingState } = WalletConnectPageStateContainer.useContainer();\n  const onClick = useCallback(\n    async ({ itemID }: { itemID: number }) => {\n      setSellingState(\"givingPermission\");\n      try {\n        const tx: ethers.providers.TransactionResponse = await tokenContract!.approve(\n          CUBIFOX_MARKET_CONTRACT_ADDRESS,\n          itemID\n        );\n        const result = await tx.wait();\n        if (result.status == 1) {\n          setSellingState(\"permitted\");\n        } else {\n          // 失敗するトランザクションは metamask 実行前にはじかれるはずなのでここは通らないかもしれない\n          setSellingState(\"failure\");\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    },\n    [tokenContract]\n  );\n\n  return <button onClick={() => onClick({ itemID })}>Give Permission</button>;\n};\n","import React, { ChangeEvent } from \"react\";\nimport { MaticUnit } from \"../../types/MaticUnit\";\n\nexport const PriceSelect = ({\n  price,\n  unit,\n  setPrice,\n  setUnit,\n}: {\n  price: number;\n  unit: MaticUnit;\n  setPrice: React.Dispatch<React.SetStateAction<number>>;\n  setUnit: React.Dispatch<React.SetStateAction<MaticUnit>>;\n}) => {\n  return (\n    <span>\n      <label>price</label>\n      <input\n        type=\"number\"\n        min=\"0\"\n        value={price}\n        onChange={(e: ChangeEvent<HTMLInputElement>) => {\n          setPrice(parseInt(e.target.value));\n        }}\n      />\n      <select\n        value={unit}\n        onChange={(e) => {\n          setUnit(e.target.value as MaticUnit);\n        }}\n      >\n        <option value=\"weiMatic\">wei MATIC</option>\n        <option value=\"gweiMatic\">gwei MATIC</option>\n        <option value=\"matic\">MATIC</option>\n      </select>\n    </span>\n  );\n};\n","import { MaticUnit } from \"../types/MaticUnit\";\n\nexport const weiPrice = ({\n  price,\n  unit,\n}: {\n  price: number;\n  unit: MaticUnit;\n}): BigInt => {\n  if (unit == \"weiMatic\") {\n    return BigInt(price);\n  } else if (unit == \"gweiMatic\") {\n    return BigInt(price * 10 ** 9);\n  } else {\n    return BigInt(price * 10 ** 18);\n  }\n};\n","import React, { useCallback } from \"react\";\nimport { ethers } from \"ethers\";\nimport { weiPrice } from \"../../utils/weiPrice\";\nimport { MaticUnit } from \"../../types/MaticUnit\";\nimport { useQuery } from \"../../hooks/useQuery\";\nimport { ContractContainer } from \"../../hooks/useContract\";\nimport { WalletConnectPageStateContainer } from \"../../hooks/useWalletConnectPageState\";\n\nexport const SellButton = ({\n  price,\n  unit,\n}: {\n  price: number;\n  unit: MaticUnit;\n}) => {\n  const { itemID } = useQuery();\n  const { marketContract } = ContractContainer.useContainer();\n  const { setSellingState } = WalletConnectPageStateContainer.useContainer();\n\n  const onSell = useCallback(async () => {\n    try {\n      setSellingState(\"executing\");\n      const wei = ethers.utils.parseUnits(\n        weiPrice({ price: price, unit: unit }).toString(),\n        \"wei\"\n      );\n      const tx: ethers.providers.TransactionResponse = await marketContract!.openTrade(\n        itemID,\n        wei\n      );\n      const result = await tx.wait();\n      if (result.status == 1) {\n        setSellingState(\"success\");\n      } else {\n        // 失敗するトランザクションは metamask 実行前にはじかれるはずなのでここは通らないかもしれない\n        setSellingState(\"failure\");\n      }\n    } catch (err) {\n      console.log(err);\n      setSellingState(\"failure\");\n    }\n  }, [marketContract, price]);\n\n  if (price >= 0) return <button onClick={onSell}>Sell</button>;\n\n  return <button disabled>Sell</button>;\n};\n","import React, { useState } from \"react\";\nimport { MaticUnit } from \"../../types/MaticUnit\";\nimport { ApproveButton } from \"./ApproveButton\";\nimport { PriceSelect } from \"./PriceSelect\";\nimport { SellButton } from \"./SellButton\";\nimport { WalletConnectPageStateContainer } from \"../../hooks/useWalletConnectPageState\";\nimport { ItemOwnerAddressContainer } from \"../../hooks/useItemOwnerAddress\";\nimport { CUBIFOX_MARKET_CONTRACT_ADDRESS } from \"../../constants\";\n\nexport const SellerActionArea = ({\n  itemBelongsCurrentUser,\n}: {\n  itemBelongsCurrentUser: boolean;\n}) => {\n  const [price, setPrice] = useState<number>(0);\n  const [unit, setUnit] = useState<MaticUnit>(\"weiMatic\");\n  const { sellingState } = WalletConnectPageStateContainer.useContainer();\n\n  if (!itemBelongsCurrentUser || sellingState == \"success\") return null;\n\n  if (sellingState == \"init\")\n    return (\n      <>\n        <p className=\"description\">\n          CubifoxMarket needs a permission of keeping your collectible.\n          <br />\n          Until the item sold, you can cancel listing the item anytime and then\n          the item will be returned to you.\n        </p>\n        <ApproveButton />\n      </>\n    );\n\n  if (sellingState == \"givingPermission\" || sellingState == \"executing\")\n    return (\n      <p className=\"message\">\n        Request was sended. Please open your wallet app and approve the\n        transaction. It'll take few hours to finish transact.\n      </p>\n    );\n\n  if (sellingState == \"permitted\")\n    return (\n      <>\n        <PriceSelect {...{ price, unit, setPrice, setUnit }} />\n        <SellButton price={price} unit={unit} />\n      </>\n    );\n\n  if (sellingState == \"failure\")\n    return <p className=\"message\">Error is occurred.</p>;\n\n  return null;\n};\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { ItemInfoTable } from \"../ItemInfoTable\";\nimport { SellerActionArea } from \"./SellerActionArea\";\nimport { useQuery } from \"../../hooks/useQuery\";\nimport { ContractContainer } from \"../../hooks/useContract\";\nimport { WalletConnectPageStateContainer } from \"../../hooks/useWalletConnectPageState\";\nimport { CUBIFOX_MARKET_CONTRACT_ADDRESS } from \"../../constants\";\nimport { ItemOwnerAddressContainer } from \"../../hooks/useItemOwnerAddress\";\nimport { Web3ProviderContainer } from \"../../hooks/useWeb3Provider\";\n\nexport const SellerView = () => {\n  const { itemID } = useQuery();\n  const { tokenContract } = ContractContainer.useContainer();\n  const {\n    sellingState,\n    setSellingState,\n  } = WalletConnectPageStateContainer.useContainer();\n  const {\n    itemOwnerAddress,\n    resolveCurrentOwner,\n  } = ItemOwnerAddressContainer.useContainer();\n  const { currentUserAddress } = Web3ProviderContainer.useContainer();\n\n  // sellingStateを初期化\n  useEffect(() => {\n    setSellingState(\"init\");\n  }, []);\n\n  // sellingStateが init か success の時にitemOwnerを再取得する\n  useEffect(() => {\n    if (sellingState == \"success\" || sellingState == \"init\") {\n      (async () => {\n        resolveCurrentOwner();\n      })();\n    }\n  }, [sellingState]);\n\n  // sellingState が givingPermission の時 tokenContract.getApproved() を3秒ごとに実行する\n  useEffect(() => {\n    if (!tokenContract) return;\n    if (sellingState != \"givingPermission\") return;\n\n    const timer = setInterval(async () => {\n      try {\n        const approvedOperator = await tokenContract.getApproved(itemID);\n        if (approvedOperator == CUBIFOX_MARKET_CONTRACT_ADDRESS) {\n          setSellingState(\"permitted\");\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    }, 3000);\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, [tokenContract, sellingState]);\n\n  const itemBelongsCurrentUser = useCallback(() => {\n    if (!currentUserAddress || !itemOwnerAddress) return false;\n    return currentUserAddress.toUpperCase() === itemOwnerAddress.toUpperCase();\n  }, [currentUserAddress, itemOwnerAddress]);\n\n  return (\n    <>\n      {itemOwnerAddress &&\n        itemOwnerAddress!.includes(CUBIFOX_MARKET_CONTRACT_ADDRESS) && (\n          <p>This item is already listed on sale.</p>\n        )}\n      {itemBelongsCurrentUser() && <p>List your collectible</p>}\n\n      <ItemInfoTable sellingState={sellingState} />\n      <SellerActionArea itemBelongsCurrentUser={itemBelongsCurrentUser()} />\n    </>\n  );\n};\n","import React, { useCallback, useEffect } from \"react\";\nimport { useQuery } from \"./hooks/useQuery\";\nimport { WalletConnectPageStateContainer } from \"./hooks/useWalletConnectPageState\";\nimport { ContractContainer } from \"./hooks/useContract\";\nimport { MetadataContainer } from \"./hooks/useMetadata\";\nimport { Web3ProviderContainer } from \"./hooks/useWeb3Provider\";\nimport { providers } from \"ethers\";\nimport { BuyerView } from \"./components/buyerview/BuyerView\";\nimport { SellerView } from \"./components/sellerview/SellerView\";\nimport \"./WalletConnectPage.css\";\n\nexport const WalletConnectPage = () => {\n  const { tradeID } = useQuery();\n  const {\n    userType,\n    setUserType,\n    preparingState,\n    buyingState,\n    sellingState,\n    setPreparingState,\n  } = WalletConnectPageStateContainer.useContainer();\n  const {\n    wcProvider,\n    setWCProvider,\n    setupWCProvider,\n    getCurrentUser,\n  } = Web3ProviderContainer.useContainer();\n  const {\n    linkMarketContract,\n    linkTokenContract,\n  } = ContractContainer.useContainer();\n  const { fetchMetadata, metadata } = MetadataContainer.useContainer();\n\n  // 今の状態を確認するためだけの useEffect\n  useEffect(() => {\n    console.log({ preparingState, buyingState, sellingState, metadata });\n  }, [preparingState, buyingState, sellingState]);\n\n  // walletconnectでウォレットとのセッションをつなげる\n  useEffect(() => {\n    if (wcProvider) return;\n\n    setPreparingState(\"setupProvider\");\n    (async () => {\n      await setupWCProvider();\n    })();\n  }, [wcProvider]);\n\n  // currentUser、metadata を取得\n  useEffect(() => {\n    if (!wcProvider) return;\n\n    void getCurrentUser(wcProvider);\n\n    const provider = new providers.Web3Provider(wcProvider);\n    linkMarketContract(provider);\n    const tokenContract = linkTokenContract(provider);\n\n    setPreparingState(\"gettingMetadata\");\n    void fetchMetadata(tokenContract).then(() => {\n      setPreparingState(\"ready\");\n    });\n  }, [wcProvider]);\n\n  // setUserType する\n  useEffect(() => {\n    if (tradeID) {\n      setUserType(\"buyer\");\n    } else {\n      setUserType(\"seller\");\n    }\n  }, [tradeID]);\n\n  // Walletとのセッションを切断する\n  const onDisconnect = useCallback(async () => {\n    if (!wcProvider) return;\n\n    await wcProvider.disconnect();\n    window.localStorage.removeItem(\"walletconnect\");\n    setWCProvider(undefined);\n  }, [wcProvider]);\n\n  if (!wcProvider) return <h2>Needed to reaload this window.</h2>;\n  if (preparingState != \"ready\") return <></>;\n\n  return (\n    <>\n      <button onClick={onDisconnect}>disconnect</button>\n      {userType == \"buyer\" && <BuyerView />}\n      {userType == \"seller\" && <SellerView />}\n    </>\n  );\n};\n","import { BrowserRouter as Router, Routes, Route } from \"react-router-dom\";\nimport \"./App.css\";\nimport logo from \"./logo.svg\";\nimport React from \"react\";\nimport { MetadataContainer } from \"./hooks/useMetadata\";\nimport { Web3ProviderContainer } from \"./hooks/useWeb3Provider\";\nimport { ContractContainer } from \"./hooks/useContract\";\nimport { WalletConnectPageStateContainer } from \"./hooks/useWalletConnectPageState\";\nimport { WalletConnectPage } from \"./WalletConnectPage\";\nimport { ItemOwnerAddressContainer } from \"./hooks/useItemOwnerAddress\";\n\nfunction App() {\n  return (\n    <Router>\n      <WalletConnectPageStateContainer.Provider>\n        <Web3ProviderContainer.Provider>\n          <ContractContainer.Provider>\n            <MetadataContainer.Provider>\n              <ItemOwnerAddressContainer.Provider>\n                <div className=\"App\">\n                  <header className=\"App-header\">\n                    <img src={logo} className=\"App-logo\" alt=\"logo\" />\n                    <Routes>\n                      <Route path=\"/\" element={<WalletConnectPage />} />\n                    </Routes>\n                  </header>\n                </div>\n              </ItemOwnerAddressContainer.Provider>\n            </MetadataContainer.Provider>\n          </ContractContainer.Provider>\n        </Web3ProviderContainer.Provider>\n      </WalletConnectPageStateContainer.Provider>\n    </Router>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(\n  document.getElementById('root') as HTMLElement\n);\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","module.exports = __webpack_public_path__ + \"static/media/logo.06e73328.svg\";"],"sourceRoot":""}
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{106:function(e,t,n){e.exports=n(177)},113:function(e,t,n){},115:function(e,t,n){},121:function(e,t){},161:function(e,t){},169:function(e,t){},175:function(e,t,n){},177:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n.n(r),c=n(89),u=n.n(c),s=(n(113),n(57)),i=n(3),l=(n(115),n(90)),o=n.n(l),p=n(1),m=n.n(p),f=n(11),b=n(16),d=function(e){var t=e.ipfsURI;return t.startsWith("https")?t:"https://nftstorage.link/ipfs/"+t.replace("ipfs://","")},g=function(){var e=Object(i.e)().search,t=Object(r.useMemo)(function(){return new URLSearchParams(e)},[e]);return{tradeID:parseInt(t.get("tradeID")),poster:t.get("poster"),itemID:parseInt(t.get("itemID")),price:parseInt(t.get("price"))}},v=n(27),w=Object(v.a)(function(){var e=g().itemID,t=Object(r.useState)("init"),n=Object(b.a)(t,2),a=n[0],c=n[1],u=Object(r.useState)(null),s=Object(b.a)(u,2),i=s[0],l=s[1],o=Object(r.useState)(),p=Object(b.a)(o,2),v=p[0],w=p[1];return{metadata:v,fetchMetadata:Object(r.useCallback)(function(){var t=Object(f.a)(m.a.mark(function t(n){var r,a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l(null),c("requesting"),t.prev=2,t.next=5,n.tokenURI(e);case 5:return r=t.sent,t.next=8,fetch(d({ipfsURI:r}));case 8:if(!(a=t.sent).ok){t.next=17;break}return t.t0=w,t.next=13,a.json();case 13:t.t1=t.sent,(0,t.t0)(t.t1),t.next=22;break;case 17:return t.t2=l,t.next=20,a.text();case 20:t.t3=t.sent,(0,t.t2)(t.t3);case 22:t.next=28;break;case 24:t.prev=24,t.t4=t.catch(2),console.log("err",t.t4),l(t.t4.message);case 28:return t.prev=28,c("done"),t.finish(28);case 31:case"end":return t.stop()}},t,null,[[2,24,28,31]])}));return function(e){return t.apply(this,arguments)}}(),[e]),status:a,error:i}}),O=n(105),C="0xa55E0A9F4DB29c03EfAb9D063B03309b73Cf32AA",E=["function tradeIdCounter() view returns (uint256)","function openTrade(uint256 _itemId, uint256 _price)","function executeTrade(uint256 _tradeId) payable"],j=["function approve(address to, uint256 tokenId)","function getApproved(uint256 tokenId) view returns (address operator)","function tokenURI(uint256 tokenId) public view returns (string memory)","function ownerOf(uint256 tokenId) public view returns (address)"],k=Object(v.a)(function(){var e=Object(r.useState)(),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(),u=Object(b.a)(c,2),s=u[0],i=u[1],l=Object(r.useCallback)(Object(f.a)(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new O.a({rpc:{80001:"https://polygon-mumbai.infura.io/v3/1622077723654f928aaae17148265be5"}}),e.next=3,t.enable();case 3:return i(t),e.abrupt("return",s);case 5:case"end":return e.stop()}},e)})),[]),o=Object(r.useCallback)(function(){var e=Object(f.a)(m.a.mark(function e(t){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getNetwork();case 2:return n=e.sent,e.abrupt("return",80001==n.chainId);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[]),p=Object(r.useCallback)(function(){var e=Object(f.a)(m.a.mark(function e(t){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.request({method:"eth_requestAccounts"});case 2:n=e.sent,a(n[0]);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[a]);return{currentUserAddress:n,wcProvider:s,setWCProvider:i,setupWCProvider:l,checkNetworkIsCorrect:o,getCurrentUser:p}}),h=n(31),x=Object(v.a)(function(){var e=Object(r.useState)(),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(),u=Object(b.a)(c,2),s=u[0],i=u[1];return{marketContract:n,tokenContract:s,linkMarketContract:Object(r.useCallback)(function(e){try{var t=e.getSigner(),n=new h.a.Contract(C,E,e);a(n.connect(t))}catch(r){throw r}},[a]),linkTokenContract:Object(r.useCallback)(function(e){try{var t=e.getSigner(),n=new h.a.Contract("0x9967a309fce3De66A70704431338a3d086509732",j,e).connect(t);return i(n),n}catch(r){throw r}},[i])}}),S=Object(v.a)(function(){var e=Object(r.useState)("setupProvider"),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(),u=Object(b.a)(c,2),s=u[0],i=u[1],l=Object(r.useState)(),o=Object(b.a)(l,2),p=o[0],m=o[1],f=Object(r.useState)(),d=Object(b.a)(f,2);return{preparingState:n,setPreparingState:a,userType:s,setUserType:i,sellingState:p,setSellingState:m,buyingState:d[0],setBuyingState:d[1]}}),I=n(12),y=Object(v.a)(function(){var e=g(),t=e.poster,n=e.itemID,a=S.useContainer(),c=a.buyingState,u=a.sellingState,s=x.useContainer().tokenContract,i=Object(r.useState)(),l=Object(b.a)(i,2),o=l[0],p=l[1];return{itemOwnerAddress:o,resolveCurrentOwner:Object(r.useCallback)(Object(f.a)(m.a.mark(function e(){var r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return r="",e.prev=3,e.next=6,s.ownerOf(n);case 6:r=e.sent,p(r),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("err",e.t0);case 13:r.toUpperCase()==C.toUpperCase()&&void 0!=c&&p(t),r.toUpperCase()==C.toUpperCase()&&void 0!=u&&p("Cubifox Market (".concat(C,")"));case 15:case"end":return e.stop()}},e,null,[[3,10]])})),[n,s,u,c])}}),U=n(181),A=n(104),P=n(61),D=n(179),T={ja:{wcp:P},en:{wcp:P}};A.a.use(D.e).init({lng:"ja",ns:["wcp"],interpolation:{escapeValue:!1},resources:T,debug:!1});var M=function(e){var t=e.buyingState,n=e.sellingState,c=e.itemBelongsCurrentUser,u=Object(U.a)(["wcp"]).t,s=g().price,i=k.useContainer().currentUserAddress,l=w.useContainer().metadata,o=y.useContainer(),p=o.itemOwnerAddress,b=o.resolveCurrentOwner;return Object(r.useEffect)(function(){Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:case"end":return e.stop()}},e)}))()},[t,n,p]),l?a.a.createElement("table",null,a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("th",null,u("wcp:itemInfo:yourAddress")),a.a.createElement("td",null,i)),a.a.createElement("tr",null,a.a.createElement("th",null,u("wcp:itemInfo:itemName")),a.a.createElement("td",null,l.name)),a.a.createElement("tr",null,a.a.createElement("th",null,u("wcp:itemInfo:itemDescription")),a.a.createElement("td",null,l.description)),a.a.createElement("tr",null,a.a.createElement("th",null,u("wcp:itemInfo:itemImage")),a.a.createElement("td",null,a.a.createElement("img",{style:{maxWidth:"50vw"},src:d({ipfsURI:l.image})}))),a.a.createElement("tr",null,a.a.createElement("th",null,u("wcp:itemInfo:currentOwner")),a.a.createElement("td",null,p)),s&&!c?a.a.createElement("tr",null,a.a.createElement("th",null,u("wcp:itemInfo:price")),a.a.createElement("td",null,s," Wei MATIC")):a.a.createElement(a.a.Fragment,null))):null},B=n(103),F=function(e){var t=e.itemBelongsCurrentUser,n=Object(U.a)(["wcp"]).t,c=g(),u=c.tradeID,s=c.price,i=S.useContainer(),l=i.setBuyingState,o=i.buyingState,p=x.useContainer().marketContract,b=Object(r.useCallback)(function(){var e=Object(f.a)(m.a.mark(function e(t){var n,r,a,c,u;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tradeID,r=t.price,l("executing"),e.prev=2,a=h.a.utils.parseUnits(r.toString(),"wei"),console.log("price: ",a),e.next=7,p.executeTrade(n,{value:a});case 7:return c=e.sent,e.next=10,c.wait();case 10:1==(u=e.sent).status?l("success"):(console.log("failure [result]:",u),l("failure")),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),console.log(e.t0),l("failure");case 18:case"end":return e.stop()}},e,null,[[2,14]])}));return function(t){return e.apply(this,arguments)}}(),[]);return t||"success"==o?null:"executing"==o?a.a.createElement("p",{className:"message"},n("wcp:buyer:action:message:executing")):"failure"==o?a.a.createElement("p",{className:"message"},n("wcp:buyer:action:message:failure")):a.a.createElement("button",{onClick:function(){return b(Object(B.a)({},{tradeID:u,price:s}))}},n("wcp:buyer:action:button:buy"))},N=function(){var e=Object(U.a)(["wcp"]).t,t=S.useContainer(),n=t.buyingState,c=t.setBuyingState,u=y.useContainer().itemOwnerAddress,s=k.useContainer().currentUserAddress,i=Object(r.useState)(!1),l=Object(b.a)(i,2),o=l[0],p=l[1];return Object(r.useEffect)(function(){c("init")},[]),Object(r.useEffect)(function(){s&&u&&s.toUpperCase()==u.toUpperCase()&&p(!0)},[u,s]),a.a.createElement(a.a.Fragment,null,o?a.a.createElement("p",null,e("wcp:buyer:successTitle")):a.a.createElement("p",null,e("wcp:buyer:title")),a.a.createElement(M,{buyingState:n,itemBelongsCurrentUser:o}),a.a.createElement(F,{itemBelongsCurrentUser:o}))},W=function(){var e=Object(U.a)(["wcp"]).t,t=g().itemID,n=x.useContainer().tokenContract,c=S.useContainer().setSellingState,u=Object(r.useCallback)(function(){var e=Object(f.a)(m.a.mark(function e(t){var r,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.itemID,c("givingPermission"),e.prev=2,e.next=5,n.approve(C,r);case 5:return a=e.sent,e.next=8,a.wait();case 8:1==e.sent.status?c("permitted"):c("failure"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log(e.t0);case 15:case"end":return e.stop()}},e,null,[[2,12]])}));return function(t){return e.apply(this,arguments)}}(),[n]);return a.a.createElement("button",{onClick:function(){return u({itemID:t})}},e("wcp:seller:action:button:approve"))},R=function(e){var t=e.price,n=e.unit,r=e.setPrice,c=e.setUnit,u=Object(U.a)(["wcp"]).t;return a.a.createElement("span",null,a.a.createElement("label",null,u("wcp:seller:action:label:price")),a.a.createElement("input",{type:"number",min:"0",value:t,onChange:function(e){r(parseInt(e.target.value))}}),a.a.createElement("select",{value:n,onChange:function(e){c(e.target.value)}},a.a.createElement("option",{value:"weiMatic"},"wei MATIC"),a.a.createElement("option",{value:"gweiMatic"},"gwei MATIC"),a.a.createElement("option",{value:"matic"},"MATIC")))},_=function(e){var t=e.price,n=e.unit;return"weiMatic"==n?BigInt(t):"gweiMatic"==n?BigInt(t*Math.pow(10,9)):BigInt(t*Math.pow(10,18))},q=function(e){var t=e.price,n=e.unit,c=Object(U.a)(["wcp"]).t,u=g().itemID,s=x.useContainer().marketContract,i=S.useContainer().setSellingState,l=Object(r.useCallback)(Object(f.a)(m.a.mark(function e(){var r,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i("executing"),r=h.a.utils.parseUnits(_({price:t,unit:n}).toString(),"wei"),e.next=5,s.openTrade(u,r);case 5:return a=e.sent,e.next=8,a.wait();case 8:1==e.sent.status?i("success"):i("failure"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),i("failure");case 16:case"end":return e.stop()}},e,null,[[0,12]])})),[s,t]);return t>=0?a.a.createElement("button",{onClick:l},c("wcp:seller:action:button:sell")):a.a.createElement("button",{disabled:!0},c("wcp:seller:action:button:sell"))},L=function(e){var t=e.itemBelongsCurrentUser,n=Object(U.a)(["wcp"]).t,c=Object(r.useState)(0),u=Object(b.a)(c,2),s=u[0],i=u[1],l=Object(r.useState)("weiMatic"),o=Object(b.a)(l,2),p=o[0],m=o[1],f=S.useContainer().sellingState;return t&&"success"!=f?"init"==f?a.a.createElement(a.a.Fragment,null,a.a.createElement("p",{className:"description"},n("wcp:seller:action:message:description")),a.a.createElement(W,null)):"givingPermission"==f||"executing"==f?a.a.createElement("p",{className:"message"},n("wcp:seller:action:message:executing")):"permitted"==f?a.a.createElement(a.a.Fragment,null,a.a.createElement(R,{price:s,unit:p,setPrice:i,setUnit:m}),a.a.createElement(q,{price:s,unit:p})):"failure"==f?a.a.createElement("p",{className:"message"},n("wcp:seller:action:message:failure")):null:null},J=function(){var e=Object(U.a)(["wcp"]).t,t=g().itemID,n=x.useContainer().tokenContract,c=S.useContainer(),u=c.sellingState,s=c.setSellingState,i=y.useContainer(),l=i.itemOwnerAddress,o=i.resolveCurrentOwner,p=k.useContainer().currentUserAddress;Object(r.useEffect)(function(){s("init")},[]),Object(r.useEffect)(function(){"success"!=u&&"init"!=u||Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o();case 1:case"end":return e.stop()}},e)}))()},[u]),Object(r.useEffect)(function(){if(n&&"givingPermission"==u){var e=setInterval(Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getApproved(t);case 3:e.sent==C&&s("permitted"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])})),3e3);return function(){clearInterval(e)}}},[n,u]);var b=Object(r.useCallback)(function(){return!(!p||!l)&&p.toUpperCase()===l.toUpperCase()},[p,l]);return a.a.createElement(a.a.Fragment,null,l&&l.includes(C)&&a.a.createElement("p",null,e("wcp:seller:successTitle")),b()&&a.a.createElement("p",null,e("wcp:seller:title")),a.a.createElement(M,{sellingState:u}),a.a.createElement(L,{itemBelongsCurrentUser:b()}))},V=(n(175),function(){var e=Object(U.a)(["wcp"]).t,t=g().tradeID,n=S.useContainer(),c=n.userType,u=n.setUserType,s=n.preparingState,i=n.buyingState,l=n.sellingState,o=n.setPreparingState,p=k.useContainer(),b=p.wcProvider,d=p.setWCProvider,v=p.setupWCProvider,O=p.getCurrentUser,C=x.useContainer(),E=C.linkMarketContract,j=C.linkTokenContract,h=w.useContainer(),y=h.fetchMetadata,A=h.metadata;Object(r.useEffect)(function(){console.log({preparingState:s,buyingState:i,sellingState:l,metadata:A})},[s,i,l]),Object(r.useEffect)(function(){b||(o("setupProvider"),Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:case"end":return e.stop()}},e)}))())},[b]),Object(r.useEffect)(function(){if(b){O(b);var e=new I.providers.Web3Provider(b);E(e);var t=j(e);o("gettingMetadata"),y(t).then(function(){o("ready")})}},[b]),Object(r.useEffect)(function(){u(t?"buyer":"seller")},[t]);var P=Object(r.useCallback)(Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,b.disconnect();case 4:window.localStorage.removeItem("walletconnect"),d(void 0);case 6:case"end":return e.stop()}},e)})),[b]);return b?"ready"!=s?a.a.createElement(a.a.Fragment,null):a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{onClick:P},e("wcp:preparing:disconnect")),"buyer"==c&&a.a.createElement(N,null),"seller"==c&&a.a.createElement(J,null)):a.a.createElement("h2",null,e("wcp:preparing:needWindowReload"))});var z=function(){return a.a.createElement(s.a,null,a.a.createElement(S.Provider,null,a.a.createElement(k.Provider,null,a.a.createElement(x.Provider,null,a.a.createElement(w.Provider,null,a.a.createElement(y.Provider,null,a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("img",{src:o.a,className:"App-logo",alt:"logo"}),a.a.createElement(i.c,null,a.a.createElement(i.a,{path:"/",element:a.a.createElement(V,null)}))))))))))},G=function(e){e&&e instanceof Function&&n.e(1).then(n.bind(null,180)).then(function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,u=t.getTTFB;n(e),r(e),a(e),c(e),u(e)})};u.a.createRoot(document.getElementById("root")).render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(z,null))),G()},61:function(e){e.exports={preparing:{disconnect:"\u30a6\u30a9\u30ec\u30c3\u30c8\u63a5\u7d9a\u89e3\u9664",needWindowReload:"\u753b\u9762\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"},seller:{title:"NFT\u3092\u58f2\u5374",successTitle:"\u3053\u306e\u5546\u54c1\u306f\u51fa\u54c1\u6e08\u3067\u3059",action:{label:{price:"\u4fa1\u683c"},message:{description:"CubifoxMarket\u306f\u3001\u3042\u306a\u305f\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4fdd\u7ba1\u3059\u308b\u8a31\u53ef\u3092\u5fc5\u8981\u3068\u3057\u307e\u3059\u3002\u5546\u54c1\u304c\u58f2\u308c\u308b\u307e\u3067\u306f\u3044\u3064\u3067\u3082\u51fa\u54c1\u3092\u53d6\u308a\u6d88\u3059\u3053\u3068\u304c\u3067\u304d\u3001\u305d\u306e\u5834\u5408\u30a2\u30a4\u30c6\u30e0\u306f\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002",executing:"\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3057\u305f\u3002\u30a6\u30a9\u30ec\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3001\u53d6\u5f15\u3092\u627f\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u53d6\u5f15\u5b8c\u4e86\u307e\u3067\u6570\u6642\u9593\u307b\u3069\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002",failure:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u753b\u9762\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044"},button:{approve:"\u8a31\u53ef\u3059\u308b",sell:"\u58f2\u5374\u3059\u308b"}}},buyer:{title:"NFT\u3092\u8cfc\u5165",successTitle:"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u3042\u306a\u305f\u306e\u3082\u306e\u3067\u3059",action:{message:{executing:"\u30a2\u30a4\u30c6\u30e0\u8cfc\u5165\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3057\u305f\u3002\u30a6\u30a9\u30ec\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3001\u53d6\u5f15\u3092\u627f\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u53d6\u5f15\u306e\u5b8c\u4e86\u306b\u306f\u6570\u6642\u9593\u304b\u304b\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002",failure:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u753b\u9762\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044"},button:{buy:"\u8cfc\u5165\u3059\u308b"}}},itemInfo:{yourAddress:"\u3042\u306a\u305f\u306e\u30a2\u30c9\u30ec\u30b9",itemName:"\u30a2\u30a4\u30c6\u30e0\u540d",itemDescription:"\u30a2\u30a4\u30c6\u30e0\u306e\u8a73\u7d30",itemImage:"3D\u30a4\u30e1\u30fc\u30b8\u753b\u50cf",currentOwner:"\u73fe\u5728\u306e\u6240\u6709\u8005",price:"\u4fa1\u683c"}}},90:function(e,t,n){e.exports=n.p+"static/media/logo.06e73328.svg"}},[[106,3,2]]]);
//# sourceMappingURL=main.90ec93de.chunk.js.map
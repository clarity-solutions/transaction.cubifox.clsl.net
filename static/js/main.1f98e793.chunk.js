(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{31:function(e,t,n){e.exports=n.p+"static/media/logo.06e73328.svg"},39:function(e,t,n){e.exports=n(64)},46:function(e,t,n){},48:function(e,t,n){},50:function(e,t,n){},54:function(e,t){},63:function(e,t){},64:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n.n(a),c=n(30),l=n.n(c),u=(n(46),n(20)),i=(n(48),n(31)),s=n.n(i),o=(n(50),n(8)),m=n(13),p=n(15),f=["function tradeIdCounter() view returns (uint256)","function openTrade(uint256 _itemId, uint256 _price)","function executeTrade(uint256 _tradeId) payable"],b=["function approve(address to, uint256 tokenId)","function getApproved(uint256 tokenId) view returns (address operator)","function tokenURI(uint256 tokenId) public view returns (string memory)","function ownerOf(uint256 tokenId) public view returns (address)"],d=Object(p.a)(function(){var e=Object(a.useState)(),t=Object(o.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(),l=Object(o.a)(c,2),u=l[0],i=l[1];return{marketContract:n,tokenContract:u,linkMarketContract:Object(a.useCallback)(function(e){try{var t=e.getSigner(),n=new m.a.Contract("0xa55E0A9F4DB29c03EfAb9D063B03309b73Cf32AA",f,e);r(n.connect(t))}catch(a){throw a}},[r]),linkTokenContract:Object(a.useCallback)(function(e){try{var t=e.getSigner(),n=new m.a.Contract("0x9967a309fce3De66A70704431338a3d086509732",b,e).connect(t);return i(n),n}catch(a){throw a}},[i])}}),g=n(6),v=function(){var e=Object(g.c)().search,t=Object(a.useMemo)(function(){return new URLSearchParams(e)},[e]);return{tradeID:parseInt(t.get("tradeID")),poster:t.get("poster"),itemID:parseInt(t.get("itemID")),price:parseInt(t.get("price"))}},E=n(36),k=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Click here to install MetaMask!",r.a.createElement("br",null),"If you complete to install Metamask, please reload this window."),r.a.createElement("button",{onClick:function(){(new E.a).startOnboarding()}},"Install Metamask"))},w=function(){var e=Object(a.useCallback)(function(){window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:m.a.utils.hexValue(80001),rpcUrls:["https://rpc-mumbai.matic.today"],chainName:"Mumbai",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://mumbai.polygonscan.com/"]}]})},[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"The network is not collect. Please connect to Mumbai (polygon test) network.",r.a.createElement("br",null),"If you complete to change the network, please reload this window."),r.a.createElement("button",{onClick:e},"Change Network"))},h=n(38),C=n(2),O=n.n(C),I=n(11),j=function(e){var t=e.ipfsURI;return t.startsWith("https")?t:"https://nftstorage.link/ipfs/"+t.replace("ipfs://","")},S=Object(p.a)(function(){var e=v().itemID,t=Object(a.useState)("init"),n=Object(o.a)(t,2),r=n[0],c=n[1],l=Object(a.useState)(null),u=Object(o.a)(l,2),i=u[0],s=u[1],m=Object(a.useState)(),p=Object(o.a)(m,2),f=p[0],b=p[1];return{metadata:f,fetchMetadata:Object(a.useCallback)(function(){var t=Object(I.a)(O.a.mark(function t(n){var a,r;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s(null),c("requesting"),t.prev=2,t.next=5,n.tokenURI(e);case 5:return a=t.sent,t.next=8,fetch(j({ipfsURI:a}));case 8:if(!(r=t.sent).ok){t.next=17;break}return t.t0=b,t.next=13,r.json();case 13:t.t1=t.sent,(0,t.t0)(t.t1),t.next=22;break;case 17:return t.t2=s,t.next=20,r.text();case 20:t.t3=t.sent,(0,t.t2)(t.t3);case 22:t.next=28;break;case 24:t.prev=24,t.t4=t.catch(2),console.log("err",t.t4),s(t.t4.message);case 28:return t.prev=28,c("done"),t.finish(28);case 31:case"end":return t.stop()}},t,null,[[2,24,28,31]])}));return function(e){return t.apply(this,arguments)}}(),[e]),status:r,error:i}}),x=Object(p.a)(function(){var e=Object(a.useState)(),t=Object(o.a)(e,2),n=t[0],r=t[1];return{currentUserAddress:n,checkMetamaskIsInstalled:Object(a.useCallback)(function(){return!(!window.ethereum||!window.ethereum.isMetaMask)},[window.ethereum,window.ethereum.isMetaMask]),detectProvider:Object(a.useCallback)(function(){return new m.a.providers.Web3Provider(window.ethereum)},[]),checkNetworkIsCorrect:Object(a.useCallback)(function(){var e=Object(I.a)(O.a.mark(function e(t){var n;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getNetwork();case 2:return n=e.sent,e.abrupt("return",80001==n.chainId);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[]),getCurrentUser:Object(a.useCallback)(function(){var e=Object(I.a)(O.a.mark(function e(t){var n;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.send("eth_requestAccounts",[]);case 2:n=e.sent,r(n[0]);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[r])}}),y=function(e){var t=e.buyingState,n=e.sellingState,c=v().price,l=x.useContainer().currentUserAddress,u=S.useContainer().metadata,i=function(e){var t=e.buyingState,n=e.sellingState,r=v(),c=r.poster,l=r.itemID,u=d.useContainer().tokenContract,i=Object(a.useState)(),s=Object(o.a)(i,2),m=s[0],p=s[1];return Object(a.useEffect)(function(){u&&(t&&"success"!=t?p(c):"success"!=n?Object(I.a)(O.a.mark(function e(){var t;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.ownerOf(l);case 3:t=e.sent,p(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("err",e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}))():p("Cubifox Market (".concat("0xa55E0A9F4DB29c03EfAb9D063B03309b73Cf32AA",")")))},[u,t,n]),m}({sellingState:n,buyingState:t});return u?r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Your Address"),r.a.createElement("td",null,l)),r.a.createElement("tr",null,r.a.createElement("th",null,"Item Name"),r.a.createElement("td",null,u.name)),r.a.createElement("tr",null,r.a.createElement("th",null,"Item Description"),r.a.createElement("td",null,u.description)),r.a.createElement("tr",null,r.a.createElement("th",null,"Item Image"),r.a.createElement("td",null,r.a.createElement("img",{src:j({ipfsURI:u.image})}))),r.a.createElement("tr",null,r.a.createElement("th",null,"Current Owner"),r.a.createElement("td",null,i)),c?r.a.createElement("tr",null,r.a.createElement("th",null,"Price"),r.a.createElement("td",null,c," Wei MATIC")):r.a.createElement(r.a.Fragment,null))):null},M=Object(p.a)(function(){var e=Object(a.useState)("checkingMetamask"),t=Object(o.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(),l=Object(o.a)(c,2),u=l[0],i=l[1],s=Object(a.useState)(),m=Object(o.a)(s,2),p=m[0],f=m[1],b=Object(a.useState)(),d=Object(o.a)(b,2);return{preparingState:n,setPreparingState:r,userType:u,setUserType:i,sellingState:p,setSellingState:f,buyingState:d[0],setBuyingState:d[1]}}),A=function(){var e=v(),t=e.tradeID,n=e.price,c=d.useContainer().marketContract,l=M.useContainer(),u=l.buyingState,i=l.setBuyingState;Object(a.useEffect)(function(){i("init")},[]);var s=Object(a.useCallback)(function(){var e=Object(I.a)(O.a.mark(function e(t){var n,a,r,l,u;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tradeID,a=t.price,i("executing"),e.prev=2,r=m.a.utils.parseUnits(a.toString(),"wei"),console.log("price: ",r),e.next=7,c.executeTrade(n,{value:r});case 7:return l=e.sent,console.log({tx:l}),e.next=11,l.wait();case 11:1==(u=e.sent).status?(console.log("Done!"),i("success")):(console.log("failure [result]:",u),i("failure")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(e.t0),i("failure");case 19:case"end":return e.stop()}},e,null,[[2,15]])}));return function(t){return e.apply(this,arguments)}}(),[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Buy a collectible"),r.a.createElement(y,{buyingState:u}),"success"==u?r.a.createElement(r.a.Fragment,null,"Done"):"executing"==u?r.a.createElement(r.a.Fragment,null,"sending transaction ..."):r.a.createElement("button",{onClick:function(){return s(Object(h.a)({},{tradeID:t,price:n}))}},"Buy Item"))},D=function(){var e=v().itemID,t=d.useContainer().tokenContract,n=M.useContainer().setSellingState,c=Object(a.useCallback)(function(){var e=Object(I.a)(O.a.mark(function e(a){var r,c;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.itemID,n("givingPermission"),e.prev=2,e.next=5,t.approve("0xa55E0A9F4DB29c03EfAb9D063B03309b73Cf32AA",r);case 5:return c=e.sent,e.next=8,c.wait();case 8:1==e.sent.status?n("permitted"):n("failure"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log(e.t0);case 15:case"end":return e.stop()}},e,null,[[2,12]])}));return function(t){return e.apply(this,arguments)}}(),[t]);return r.a.createElement("button",{onClick:function(){return c({itemID:e})}},"Give Permission")},P=function(e){var t=e.price,n=e.unit,a=e.setPrice,c=e.setUnit;return r.a.createElement("span",null,r.a.createElement("label",null,"price"),r.a.createElement("input",{type:"number",min:"0",value:t,onChange:function(e){a(parseInt(e.target.value))}}),r.a.createElement("select",{value:n,onChange:function(e){c(e.target.value)}},r.a.createElement("option",{value:"weiMatic"},"wei MATIC"),r.a.createElement("option",{value:"gweiMatic"},"gwei MATIC"),r.a.createElement("option",{value:"matic"},"MATIC")))},T=function(e){var t=e.price,n=e.unit;return"weiMatic"==n?BigInt(t):"gweiMatic"==n?BigInt(t*Math.pow(10,9)):BigInt(t*Math.pow(10,18))},U=function(e){var t=e.price,n=e.unit,c=v().itemID,l=d.useContainer().marketContract,u=M.useContainer().setSellingState,i=Object(a.useCallback)(Object(I.a)(O.a.mark(function e(){var a,r;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u("executing"),a=m.a.utils.parseUnits(T({price:t,unit:n}).toString(),"wei"),e.next=5,l.openTrade(c,a);case 5:return r=e.sent,e.next=8,r.wait();case 8:1==e.sent.status?u("success"):u("failure"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),u("failure");case 16:case"end":return e.stop()}},e,null,[[0,12]])})),[l,t]);return t>=0?r.a.createElement("button",{onClick:i},"Sell"):r.a.createElement("button",{disabled:!0},"Sell")},B=function(){v().itemID,d.useContainer().tokenContract;var e=Object(a.useState)(0),t=Object(o.a)(e,2),n=t[0],c=t[1],l=Object(a.useState)("weiMatic"),u=Object(o.a)(l,2),i=u[0],s=u[1],m=M.useContainer(),p=m.sellingState;m.setSellingState;return"init"==p?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"description"},"CubifoxMarket needs a permission of keeping your collectible.",r.a.createElement("br",null),"Until the item sold, you can cancel listing the item anytime and then the item will be returned to you."),r.a.createElement(D,null)):"givingPermission"==p||"executing"==p?r.a.createElement("p",null,"Sending a transaction. It will take few minutes. Please don't reload this window."):"permitted"==p?r.a.createElement(r.a.Fragment,null,r.a.createElement(P,{price:n,unit:i,setPrice:c,setUnit:s}),r.a.createElement(U,{price:n,unit:i})):"success"==p?r.a.createElement("p",null,"Your item is successfully listed for sell. You can back to CubifoxMarket App."):"failure"==p?r.a.createElement("p",null,"Error is occurred."):null},F=function(){var e=v().itemID,t=d.useContainer().tokenContract,n=M.useContainer(),c=n.sellingState,l=n.setSellingState;return Object(a.useEffect)(function(){l("init")},[]),Object(a.useEffect)(function(){if(t&&"givingPermission"==c){var n=setInterval(Object(I.a)(O.a.mark(function n(){return O.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.getApproved(e);case 3:"0xa55E0A9F4DB29c03EfAb9D063B03309b73Cf32AA"==n.sent&&l("permitted"),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.log(n.t0);case 10:case"end":return n.stop()}},n,null,[[0,7]])})),3e3);return function(){clearInterval(n)}}},[t,c]),r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"List your collectible"),r.a.createElement(y,{sellingState:c}),r.a.createElement(B,null))},N=function(){var e=v().tradeID,t=M.useContainer(),n=t.userType,c=t.setUserType,l=t.preparingState,u=t.buyingState,i=t.sellingState,s=t.setPreparingState,o=x.useContainer(),m=o.checkMetamaskIsInstalled,p=o.detectProvider,f=o.checkNetworkIsCorrect,b=o.getCurrentUser,g=d.useContainer(),E=g.linkMarketContract,h=g.linkTokenContract,C=S.useContainer(),O=C.fetchMetadata,I=C.metadata;return Object(a.useEffect)(function(){console.log({preparingState:l,buyingState:u,sellingState:i,metadata:I})},[l,u,i]),Object(a.useEffect)(function(){var e=m();s(e?"detectingProvider":"noMetamask");var t=p();if(t)if(s("checkingNetwork"),f(t)){b(t),E(t);var n=h(t);s("gettingMetadata"),O(n).then(function(){s("ready")})}else s("wrongNetwork")},[]),Object(a.useEffect)(function(){c(e?"buyer":"seller")},[e]),"noMetamask"==l?r.a.createElement(k,null):"wrongNetwork"==l?r.a.createElement(w,null):"ready"==l&&"buyer"==n?r.a.createElement(A,null):"ready"==l&&"seller"==n?r.a.createElement(F,null):null};var R=function(){return r.a.createElement(u.a,null,r.a.createElement(M.Provider,null,r.a.createElement(x.Provider,null,r.a.createElement(d.Provider,null,r.a.createElement(S.Provider,null,r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:s.a,className:"App-logo",alt:"logo"}),r.a.createElement(N,null))))))))},_=function(e){e&&e instanceof Function&&n.e(1).then(n.bind(null,65)).then(function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,l=t.getTTFB;n(e),a(e),r(e),c(e),l(e)})};l.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(R,null))),_()}},[[39,3,2]]]);
//# sourceMappingURL=main.1f98e793.chunk.js.map